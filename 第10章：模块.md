# 10.2 Node 中的模块



## 1. Node 的导出

```javascript
const sum = (x, y) => x + y;
const square = x => x * x;

exports.mean = data => data.reduce(sum)/data.length;
exports.stddev = function(d) {
    let m = exports.mean(d);
    return Math.sqrt(d.map(x => x - m).map(square).reduce(sum)/(d.length - 1));
}
```



```javascript
module.exports = class BitSet extends AbstractWritableSet {};
```

```javascript
const sum = (x, y) => x + y;
const square = x => x * x;
const mean = data => data.reduce(sum)/data.length;
const stddev = d => {
    let m = mean(d);
    return Math.sqrt(d.map(x => x - m).map(square).reduce(sum)/(d.length - 1));
}

module.exports = { mean, stddev };
```



## 2. Node 的导入

```javascript
const fs = require("fs");
const http = require("http");
```



```javascript
const stats = require("./stats.js");

let average = stats.mean(data);

const { stddev } = require("./stats.js");
 
let sd = stddev(data);
```





# 10.3 ES6 中的模块



## 1. ES6 的导出

要从 ES6 模块导出常量、变量、函数或类，只要在声明前加上 export 关键词即可：

```javascript
export const PI = Math.PI;

export function degreesToRadians(d) { return d * PI / 180 };

export class Circle {
    constructor(r) { this.r = r }
    area() { return PI * this.r * this.r }
}                                                                                     
```



```javascript
export default class BitSet {}
```



## 2. ES6 的导入

```javascript
import BitSet from './bitset.js';
```

```javascript
import { mean, stddev } from "./stats.js";                    
```

```javascript
import * as stats from "./stats.js";
```



**`模块通常要么定义一个默认导出，要么定义多个命名导出。一个模块同时使用 export 和 export default 虽然合法，但并不常见。不过要是真有模块这么做，也可以只通过一条 import 语句同时导入默认值和命名值：`** 

```javascript
import Histogram, { mean, stddev } from "./histogram-stats.js";
```



import 语句还有另外一种形式，用于导入没有任何导出的模块。要在程序中包含没有导出的模块，只要在 import 关键字后面直接写出模块标识符即可：

```javascript
import "./analytics.js"
```





## 3. 导入和导出时重命名

```                   javascript
import { render as renderImage } from "./imageutils.js";
import { render as renderUI } from "./ui.js";
```



```javascript
import { default as Histogram, mean, stddev } from "./histogram-stats.js";
```



```javascript
export {
	layout as calculateLayout,
    render as renderLayout                                                      
}
```



## 4. 再导出

```javascript
import { mean } from "./stats/mean.js";
import { stddev } from "./stats/stddev.js";

export { mean, stddev };
```





## 5. 在网页中使用 JavaScript 模块

```html
<script type="module"></script>
```





## 6. 通过 import() 动态导入

**`如果要动态导入并使用这个模块，那就要这样写：`**

```javascript
import("./stats.js").then(stats => {
    let average = stats.mean(data);
})
```



**`或者，在一个 async 函数中，可以通过 await 简化代码：`**

```javascript
async analyzeData(data) {
    let stats = await import("./stats.js");
    
    return {
        average: stats.mean(data),                                    
        stddev: stats.stddev(data)
    }
}
```





​    
